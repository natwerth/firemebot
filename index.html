<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>FireMeBot — LumonOS</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' fill='%230B1B2B'/%3E%3Cpath d='M6 8h20v2H6zm0 7h20v2H6zm0 7h20v2H6z' fill='%23A7FFE5'/%3E%3C/svg%3E">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>

  <header class="topbar">
    <div class="brand">
      <div class="brand__title">FireMeBot</div>
      <div class="brand__badge muted">Will AI replace you?</div>
    </div>
    <div class="status" style="margin-bottom: 1rem;" id="status" role="status" aria-live="polite">Ready.</div>
  </header>

  <div class="container">
    <!-- Search bar moved below header -->
    <form id="job-form" class="top-input__form" autocomplete="off">
      <label for="job-input" class="sr-only">Job title</label>
      <div class="top-input__field" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <input class="input" id="job-input" name="title" type="text" placeholder="Enter your job title..." autofocus aria-describedby="progress-pct">
        <span id="progress-pct">0%</span>
      </div>
      <button id="submit-btn" type="submit" class="btn btn--primary top-input__button">Analyze</button>
    </form>

    <main class="main" id="main-content">
      <!-- Output Panel -->
      <section class="panel" aria-labelledby="out-title">
        <h2 id="out-title">—</h2>
        <div class="card" id="results-card">
          <h3 class="caps" id="out-job-title">—</h3>
          <div class="rule" aria-hidden="true"></div>
          <div class="stack-3">
            <div class="grid">
              <!-- Gauge -->
              <div class="stack-2">
                <div class="kv__k" id="risk-score-label">Risk Score</div>
                <div class="gauge" role="meter" aria-labelledby="risk-score-label" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0 out of 100">
                  <div class="gauge__bar" aria-hidden="true">
                    <div class="gauge__fill" id="gauge-fill" style="width:0%"></div>
                  </div>
                  <div class="gauge__value" id="out-score" aria-live="polite">0%</div>
                </div>
              </div>

              <!-- Analysis (typewriter) -->
              <div class="stack-2">
                <div class="kv__k">Analysis</div>
                <div id="out-analysis" class="typewriter" aria-live="polite">—</div>
              </div>

              <!-- Tips -->
              <div class="stack-2">
                <div class="kv__k">Tips</div>
                <div id="out-tips" class="typewriter">—</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Post Card -->
      <section aria-labelledby="post-title">
        <div class="card" id="post-card">
          <h3 class="caps" id="post-title">Social Post</h3>
          <div class="rule" aria-hidden="true"></div>
          <div class="stack-3">
            <div id="out-post" class="typewriter">—</div>
            <div class="cluster">
              <button id="copy-post" class="btn btn--ghost" type="button" aria-describedby="copy-status">
                <i class="fa-solid fa-copy" aria-hidden="true"></i>
              </button>
              <button id="shareBtn" class="btn btn--ghost" type="button" aria-label="Share post">
                <i class="fa-solid fa-arrow-up-from-bracket" aria-hidden="true"></i>
              </button>
              <script>
                const shareBtn = document.getElementById('shareBtn');
                const statusEl = document.getElementById('copy-status');

                shareBtn.addEventListener('click', async () => {
                  shareBtn.disabled = true;

                  // Build a clean, short title from the post content with sane fallbacks
                  const postTextRaw = (document.getElementById('out-post')?.textContent || '').replace(/\s+/g,' ').trim();
                  const fallbackTitle = (document.getElementById('out-title')?.textContent || document.title || 'FireMeBot').trim();
                  const baseTitle = (postTextRaw && postTextRaw !== '—') ? postTextRaw : fallbackTitle;
                  const shortTitle = baseTitle.length > 25 ? baseTitle.slice(0, 25) + '…' : baseTitle;

                  // Point to a FireMeBot share route so OG tags can control previews
                  const shareUrl = new URL('https://firemebot.com/share');
                  shareUrl.searchParams.set('title', shortTitle);

                  const data = {
                    title: shortTitle,
                    text: 'Check out this site before your boss replaces you with a toaster:',
                    url: shareUrl.toString()
                  };

                  try {
                    if (!navigator.share) throw new Error('no-web-share');
                    await navigator.share(data);
                  } catch (e) {
                    // Fallback: copy the URL to clipboard if possible
                    try {
                      if (navigator.clipboard?.writeText) {
                        await navigator.clipboard.writeText(data.url);
                        if (statusEl) statusEl.textContent = 'Link copied.';
                      } else {
                        if (statusEl) statusEl.textContent = 'Sharing not supported on this device.';
                      }
                    } catch {
                      if (statusEl) statusEl.textContent = 'Sharing not supported on this device.';
                    }
                  } finally {
                    setTimeout(() => { if (statusEl) statusEl.textContent = ''; shareBtn.disabled = false; }, 1800);
                  }
                });
              </script>
              <span class="muted mono" id="copy-status" aria-live="polite"></span>
            </div>
          </div>
        </div>
      </section>

      <section aria-label="try-again-card">
        <button type="button" class="btn btn--ghost try-again-btn" onclick="window.location.reload()" style="display:flex; align-items:center; color: var(--ink-muted);">
          <i class="fa-solid fa-rotate-right" aria-hidden="true" style="font-size:3rem;"></i>
          <span style="font-size:1.25rem;"></span>
        </button>
      </section>

      <!-- Error -->
      <div id="errorCard" class="card" role="alert" hidden>
        <strong class="bad caps">Error</strong>
        <div class="stack-2">
          <div id="errorMsg" class="mono"></div>
        </div>
      </div>
    </main>
  </div>

  <footer id="fm-footer">
    <a href="https://natwerth.com" target="_blank" rel="noopener noreferrer" aria-label="natwerth.com">
      <span class="logo" aria-hidden="true">
        <svg xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 152.5 96.57"
             role="img" aria-label="Nat Werth Logo">
          <title>Nat Werth Logo</title>
          <g transform="translate(2,1)" fill="currentColor">
            <path d="M13.5,30.56c18,0,27,18,27,18,0,0-9-18,9-18s18,63,0,63-27-27-27-27c0,0,9,27-9,27s-18-63,0-63Z"/>
            <path d="M148.5,30.56c0,18-18,18-18,18,0,0,9,54-18,45,0,0,18-63-18-72,9-9,54-9,54,9Z"/>
            <path d="M68.79,0s2.6,20.33,21.59,21.55c0,0-18.87,2.24-21.59,21.55,0,0-2.68-19.69-21.59-21.55,0,0,17.69-2.01,21.59-21.55Z"/>
            <path d="M91.22,38.8s1.11,8.2,9.22,8.7c0,0-8.06.91-9.22,8.7,0,0-1.15-7.95-9.22-8.7,0,0,7.56-.81,9.22-8.7Z"/>
          </g>
        </svg>
      </span>
      <span class="wordmark">natwerth.com</span>
    </a>
  </footer>
  <script src="./app.js" defer></script>
</body>
</html>